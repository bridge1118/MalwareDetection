'''
Created on 2017/7/19

@author: ful6ru04
'''
import os
import csv

class Permission(object):
    
    @staticmethod
    def read(path, android_per_only=True):
        # read all the lines in the
        assert( os.path.exists(path) )
        
        permission_list = []
        f = open(path, 'r')
        for row in csv.reader(f):
            word = row[1].split(': ')
            letter = word[1].split('.')
            if not letter[0]=='android' and android_per_only:
                continue
            permission_list.append(word[1])
        f.close()
        return permission_list
    
    @staticmethod
    def readIntoDict(path, list_of_ps=[], android_per_only=True):
        # given a list of permissions
        assert( os.path.exists(path) )
        
        name_list = []
        dict_list = [] # a list of dictionary of each apps
        first_app = True
        current_app = None
        
        f = open(path, 'r')
        for row in csv.reader(f):
            if not row[0] =='': # new app line
                name_list.append(row[0])
                if not first_app:
                    dict_list.append(current_app)
                else:
                    first_app = False
                current_app = dict.fromkeys(list_of_ps, 0) # all field of permissions in a dictionary   
                
            word = row[1].split(': ')
            letter = word[1].split('.')
            if not letter[0]=='android' and android_per_only:
                continue
            
            current_app[word[1]] = 1
            
        # store the last one
        dict_list.append(current_app)
        f.close()
        
        return dict_list, name_list
    
    @staticmethod
    def readArrayCsv(path):
        
        assert( os.path.exists(path) )
        
        attr_list = []
        
        f = open(path, 'r')
        for row in csv.reader(f):
            res = list(map(int, row)) # python 3
            attr_list.append(res)
        f.close()
        
        return attr_list
        
        